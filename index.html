<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piano Learning App</title>
<style>
  body { font-family: 'Arial', sans-serif; margin:0; background:#f0f0f0; }
  .dark { background:#1e1e1e; color:white; }
  header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:#333; color:white; }
  header h1 { margin:0; font-size:1.5rem; }
  #theme-toggle { cursor:pointer; padding:.5rem 1rem; background:#555; border:none; color:white; border-radius:5px; }
  main { padding:1rem; display:flex; flex-direction:column; gap:1rem; }
  .card { background:white; padding:1rem; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
  .dark .card { background:#2a2a2a; }
  #piano { display:flex; overflow-x:auto; user-select:none; margin-top:1rem; }
  .white { width:40px; height:150px; border:1px solid black; background:white; position:relative; margin-right:-1px; z-index:1; display:flex; justify-content:center; align-items:flex-end; font-size:10px; cursor:pointer; }
  .white.highlight { background:yellow; }
  .white.correct { background:green; color:white; }
  .white.wrong { background:red; color:white; }
  .black { width:25px; height:100px; background:black; position:relative; margin-right:-12px; z-index:2; display:flex; justify-content:center; align-items:flex-end; font-size:9px; color:white; cursor:pointer; }
  #progress-container { height:20px; background:#ccc; border-radius:10px; overflow:hidden; margin-top:.5rem; }
  #progress { height:100%; width:0%; background:green; transition:width .3s; }
  #lesson-area, #song-area { display:none; flex-direction:column; gap:.5rem; }
  button { padding:.5rem 1rem; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<header>
  <h1>Piano Learning App</h1>
  <button id="theme-toggle">Toggle Theme</button>
</header>
<main>
  <div id="calibration-card" class="card">
    <h2>Calibration</h2>
    <p id="calibration-instruction">Press the highlighted key on your piano.</p>
    <div id="piano"></div>
    <div id="progress-container"><div id="progress"></div></div>
    <button id="next-key">Continue</button>
  </div>

  <div id="lesson-card" class="card">
    <h2>Lessons</h2>
    <div id="lesson-area">
      <p id="lesson-instruction"></p>
      <button id="next-lesson">Next Note</button>
    </div>
    <button id="start-lessons">Start Lessons</button>
  </div>

  <div id="song-card" class="card">
    <h2>Song Library</h2>
    <div id="song-area">
      <input type="text" id="song-search" placeholder="Search songs">
      <div id="song-list"></div>
    </div>
    <button id="start-songs">Show Songs</button>
  </div>
</main>

<script>
// ----------- Piano Keys -----------
const NOTES = [
'A0','A#0','B0','C1','C#1','D1','D#1','E1','F1','F#1','G1','G#1','G#1',
'C2','C#2','D2','D#2','E2','F2','F#2','G2','G#2',
'C3','C#3','D3','D#3','E3','F3','F#3','G3','G#3',
'C4','C#4','D4','D#4','E4','F4','F#4','G4','G#4',
'C5','C#5','D5','D#5','E5','F5','F#5','G5','G#5',
'C6','C#6','D6','D#6','E6','F6','F#6','G6','G#6',
'C7','C#7','D7','D#7','E7','F7','F#7','G7','G#7',
'C8'
];
let currentCalibrationIndex = 0;
let calibratedNotes = [];
let lessonIndex = 0;
let theme = 'light';

// ----------- Build Piano Visual -----------
const pianoContainer = document.getElementById('piano');
function createPiano() {
  pianoContainer.innerHTML='';
  NOTES.forEach((note,i)=>{
    const isBlack = note.includes('#');
    const key = document.createElement('div');
    key.className = isBlack?'black':'white';
    key.textContent = note;
    key.dataset.note = note;
    pianoContainer.appendChild(key);
  });
}
createPiano();

// ----------- Highlight Key for Calibration -----------
function highlightKey(index) {
  const keys = pianoContainer.querySelectorAll('.white, .black');
  keys.forEach(k=>k.classList.remove('highlight','correct','wrong'));
  if(index<keys.length){
    keys[index].classList.add('highlight');
    document.getElementById('calibration-instruction').textContent = `Play: ${NOTES[index]}`;
    const progressPercent = ((index)/NOTES.length)*100;
    document.getElementById('progress').style.width = progressPercent+'%';
  }
}
highlightKey(currentCalibrationIndex);

// ----------- Mock Pitch Detection (replace with real mic logic) -----------
function detectPitchMock() {
  // Random correct or wrong for demo
  return NOTES[currentCalibrationIndex]; // for demo, always correct
}

// ----------- Calibration Logic -----------
document.getElementById('next-key').onclick = ()=>{
  const detected = detectPitchMock();
  const keys = pianoContainer.querySelectorAll('.white, .black');
  const currentKey = keys[currentCalibrationIndex];
  if(detected===NOTES[currentCalibrationIndex]){
    currentKey.classList.add('correct');
    calibratedNotes.push(detected);
    currentCalibrationIndex++;
    if(currentCalibrationIndex<NOTES.length){
      highlightKey(currentCalibrationIndex);
    } else {
      alert('Calibration complete!');
      document.getElementById('calibration-card').style.display='none';
    }
  } else {
    currentKey.classList.add('wrong');
    alert('Wrong note, try again.');
  }
};

// ----------- Theme Toggle -----------
document.getElementById('theme-toggle').onclick = ()=>{
  document.body.classList.toggle('dark');
  theme = theme==='light'?'dark':'light';
};

// ----------- Lessons Setup -----------
const lessons = [
{title:'Lesson 1', notes:['C4','D4','E4','F4']},
{title:'Lesson 2', notes:['E4','F4','G4','A4']},
{title:'Lesson 3', notes:['C4','E4','G4']}
// ... add up to 20 lessons
];
document.getElementById('start-lessons').onclick = ()=>{
  document.getElementById('lesson-area').style.display='flex';
  showLesson(0);
};
function showLesson(idx){
  lessonIndex=0;
  document.getElementById('lesson-instruction').textContent = `${lessons[idx].title}: Play ${lessons[idx].notes[lessonIndex]}`;
}
document.getElementById('next-lesson').onclick = ()=>{
  const lesson = lessons[0]; // For demo, using first lesson
  lessonIndex++;
  if(lessonIndex<lesson.notes.length){
    document.getElementById('lesson-instruction').textContent = `Play: ${lesson.notes[lessonIndex]}`;
  } else {
    alert('Lesson complete!');
  }
};

// ----------- Song Library Setup -----------
const songs = [
{name:'Song 1', notes:['C4','D4','E4']},
{name:'Song 2', notes:['E4','F4','G4']}
];
document.getElementById('start-songs').onclick = ()=>{
  document.getElementById('song-area').style.display='flex';
  renderSongs();
};
function renderSongs(){
  const container = document.getElementById('song-list');
  container.innerHTML='';
  songs.forEach(song=>{
    const div = document.createElement('div');
    div.textContent=song.name;
    div.style.cursor='pointer';
    div.style.padding='5px';
    div.style.border='1px solid #ccc';
    div.style.margin='3px';
    div.onclick = ()=>{alert(`Play song: ${song.name}`)};
    container.appendChild(div);
  });
}
</script>
</body>
</html>
